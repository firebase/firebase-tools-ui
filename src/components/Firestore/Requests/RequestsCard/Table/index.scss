/**
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@import '../../index.scss';
@import '../Header/variables.scss';
@import '../../../Requests/variables.scss';

// TODO: Remove condition when requests filters header is developed and always rendered
// (value will always be 2px when header is rendered)
$compensate-negative-margin: 0px;
@if ($filters-header-is-rendered) {
  $compensate-negative-margin: 2px;
}

// Table th
$table-header-height: 31px;

// Table td
$table-cell-height: 47px;

// Table
$table-min-height: (
  $requests-card-min-height + $compensate-negative-margin -
    $filters-header-height
);
$empty-table-min-height: ($table-header-height + $compensate-negative-margin);

// Table border-radius
// TODO: Update these variables when the requests filters header is developed and always rendered
// (condition will no longer be needed, since border-radius will always be added below the table only)
$table-border-radius: 8px;
$empty-table-border-radius: 8px 8px 0px 0px;
// if requests filters header will be rendered, do not
// add border at the top-left and top-right of the table, because
// the requests filters header will be above the table
@if ($filters-header-is-rendered) {
  $table-border-radius: 0px 0px 8px 8px;
  $empty-table-border-radius: 0px;
}

// Table margin
// TODO: Delete variable and condition when requests filters header is developed and always rendered
$table-margin: 0px;
@if ($filters-header-is-rendered) {
  $table-margin: -1px;
}

// Table border
// TODO: Delete variable and condition when requests filters header is developed and always rendered
$table-border: 0px;
@if ($filters-header-is-rendered) {
  $table-border: auto;
}

// Table tbody
$table-body-min-height: (
  $requests-card-min-height - $filters-header-height - $table-header-height
);
// Since the app-...-content variable uses calc(), a SASS interpolation
// is used in order to nest a calc() function inside another calc() function.
// CSS structure:            calc( calc(0px + 0px) - 0px)
$table-body-viewport-height: calc(
  #{$app-remaining-viewport-height-for-content} - #{$firestore-sub-tabs-total-height +
    $filters-header-height + $table-header-height}
);

// Double selector - for higher specificity to Override rmwc styles.
.Firestore-Requests-Table.Firestore-Requests-Table {
  border-radius: $table-border-radius;
  // Avoid double borders.
  // TODO: when requests filters header is developed and always rendered,
  // set margin to be always -1 and remove the border styling modification
  margin: $table-margin;
  border: $table-border;
  // Keep a min-height to keep it usable on short-devices (at the cost of page scrolling)
  min-height: $table-min-height;
  td,
  th {
    padding: 0;
    padding-left: 24px;
    // Avoid extra text height
    line-height: 1;
    @media screen and (max-width: 500px) {
      // Less padding for mobile
      padding-left: 10px;
    }
  }
  th {
    height: $table-header-height;
    font-size: 12px;
    // TODO: remove this style when sorting functionality is ready
    // (when headers are clickable)
    &.rmwc-data-table__head-cell--sorted {
      cursor: auto;
    }
    // Move sort icon to the right side
    .rmwc-data-table__sort-icon {
      position: absolute;
      right: 0px;
      margin-right: 0px;
    }
  }
  td {
    height: $table-cell-height;
  }
  thead tr {
    // Border at bottom
    box-shadow: 0px -1px 0 rgba(0, 0, 0, 0.12) inset;
  }

  // Clicklable rows styles
  tbody tr {
    cursor: pointer;
    // Select last row
    &:last-of-type {
      // Border at bottom (the last one is missing the bottom border)
      box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.12) inset;
    }
  }

  // Distribute column widths (width values include the padding-left)
  .Firestore-Requests-Table-Date-Header,
  .Firestore-Request-Date,
  .Firestore-Requests-Table-Outcome-Header,
  .Firestore-Request-Outcome,
  .Firestore-Requests-Table-Method-Header,
  .Firestore-Request-Method {
    // Causes padding to be added to the width, instead of been part of it.
    // Example (considering .Firestore-Request-Date):
    //      width: 66px + padding-right + padding-left
    box-sizing: content-box;
  }
  .Firestore-Requests-Table-Date-Header,
  .Firestore-Request-Date {
    width: 66px;
  }
  .Firestore-Requests-Table-Outcome-Header,
  .Firestore-Request-Outcome {
    width: 26px;
  }
  .Firestore-Requests-Table-Method-Header,
  .Firestore-Request-Method {
    width: 60px;
  }

  // Add small padding to path on mobile, since the copyIconButton is no longer displayed
  // is important to add the padding to both the Path header and cells
  .Firestore-Requests-Table-Path-Header,
  .Firestore-Request-Path {
    @media screen and (max-width: 500px) {
      padding-right: 12px;
    }
  }

  // Fix body height and ensure tbody content scrollable behavior
  thead,
  tbody tr {
    // This styles are required in order to apply scrolling overflow to tbody
    display: table;
    table-layout: fixed;
    width: 100%;
  }
  tbody {
    background-color: white;
    min-height: $table-body-min-height;
    height: $table-body-viewport-height;
    // This styles are required in order to apply scrolling overflow to tbody
    display: block;
    overflow: auto;
  }
}

.Firestore-Requests-Table.Firestore-Requests-Table.Firestore-Requests-Table--Empty {
  border-radius: $empty-table-border-radius;
  // Make table height equal to the height of the requestTableHeader,
  // helpful to display the Zero State message
  min-height: $empty-table-min-height;
  tbody {
    // No content to display
    height: 0px;
    min-height: 0px;
  }
}
